# Cypress Output Formats

## Overview

Cypress allows you to generate test reports in various formats, enabling better integration with CI/CD tools, project management, and team collaboration. This documentation covers the following output formats:

- **Markdown** (using custom reporter)
- **CSV** (using custom reporter)
- **HTML** (using Mochawesome)
- **XML** (using Mocha JUnit Reporter)
- **JSON** (using Mochawesome)

## Prerequisites

Make sure you have Cypress installed in your project. If you haven't installed it yet, you can do so by running:

```bash
npm install cypress --save-dev
```

## Output Configurations
## 1. Built-in reporters
### a). HTML and JSON
HTML output is generated by Mochawesome and provides a detailed, styled report.
JSON output is also generated by Mochawesome and is useful for programmatic access to test results.

Install Mochawesome:
```bash
npm install mochawesome --save-dev
```

#### HTML and JSON Cypress configurations
```javascript
module.exports = {
  reporter: 'mocha-multi-reporters',
  reporterOptions: {
    reporterEnabled: 'mochawesome',
    mochawesomeReporterOptions: {
      reportDir: 'cypress/reports',
      overwrite: true,
      html: true,
      json: true,
    },
  },
};
```

### b). XML
XML output is useful for CI tools and other systems that consume XML reports. In cypress, Mocha JUnit Reporter is used.
Installing Mocha JUnit Reporter:
```bash
npm install mocha-junit-reporter --save-dev
```

#### XML Cypress configurations
```javascript
module.exports = {
  reporter: 'mocha-multi-reporters',
  reporterOptions: {
    reporterEnabled: 'mocha-junit-reporter',
    mochaJunitReporterOptions: {
      mochaFile: 'cypress/reports/test-results-[hash].xml', // Path for XML report
    },
  },
};
```

## 2. Custom Reporters

### a). Markdown
Markdown output provides a human-readable format for test results.

Custom Markdown Reporter:
```javascript
const fs = require('fs');
const path = require('path');
const Mocha = require('mocha');
const { Base } = Mocha.reporters;

class MarkdownReporter extends Base {
  constructor(runner) {
    super(runner);
    const outputPath = path.join(__dirname, 'cypress/reports/test-results.md');
    const markdownHeader = '# Test Results\n\n| Test Title | Status | Duration (ms) | Error Message |\n|------------|--------|----------------|----------------|\n';
    fs.writeFileSync(outputPath, markdownHeader);

    runner.on('test end', (test) => {
      const testResult = [
        `| ${test.title} |`,
        ` ${test.state || 'skipped'} |`,
        ` ${test.duration || 0} |`,
        test.err ? ` "${test.err.message.replace(/\n/g, '')}" |` : ' |'
      ];
      const markdownLine = testResult.join('') + '\n';
      fs.appendFileSync(outputPath, markdownLine);
    });

    runner.on('end', () => {
      console.log('Markdown report has been written to:', outputPath);
    });
  }
}

module.exports = MarkdownReporter;

```

#### Markdown Cypress configurations
```javascript
module.exports = {
  reporter: 'mocha-multi-reporters',
  reporterOptions: {
    reporterEnabled: 'mochawesome, ./markdown-reporter.js',
    mochaJunitReporterOptions: {
      mochaFile: './cypress/reports/results.xml',  // Store JUnit XML reports here
      outputs: true,
      includePending: true,
      toConsole: true
    },
  },
  e2e: {
    // Your Cypress e2e test settings here
  }
};
```

### b). CSV
CSV output is ideal for data analysis and integration with spreadsheets.

Custom csv reporter:

```javascript
// custom-csv-reporter.js
const Mocha = require('mocha');
const fs = require('fs');
const path = require('path');
const { Base } = Mocha.reporters;

// Custom CSV Reporter
class CustomCSVReporter extends Base {
  constructor(runner) {
    super(runner);

    // CSV header
    const outputPath = path.join('cypress/reports/results.csv');
    const csvHeader = 'Suite Title,Test Title,State,Duration (ms),Error Message\n';

    // Create (or overwrite) the CSV file with the header
    fs.writeFileSync(outputPath, csvHeader, (err) => {
      if (err) throw err;
    });

    // On each test completion (pass, fail, skip)
    runner.on('test end', (test) => {
      const testResult = [
        test.parent.title, // Suite Title
        test.title,        // Test Title
        test.state || 'skipped', // Test State (passed, failed, skipped)
        test.duration || 0,      // Duration in ms
        test.err ? `"${test.err.message.replace(/\n/g, '')}"` : '' // Error message, if failed
      ];

      // Append test result to CSV
      const csvLine = testResult.join(',') + '\n';
      fs.appendFileSync(outputPath, csvLine, (err) => {
        if (err) throw err;
      });
    });

    // On run end
    runner.on('end', () => {
      console.log('Test results have been written to CSV file.');
    });
  }
}

module.exports = CustomCSVReporter;

```

#### Csv cypress configuration
```javascript
module.exports = defineConfig{
reporter: 'custom-csv-reporter',
reporterOptions: {
  reportDir: 'cypress/reports',
},
e2e: {
    // Your Cypress e2e test settings here
  }
};
```

## Multi-Reporters Cypress Configurations.
```javascript
const { defineConfig } = require("cypress");

module.exports = {

  // multiple cypress reporters
  reporter: 'mocha-multi-reporters',
  reporterOptions: {
    reporterEnabled: 'mochawesome, mocha-junit-reporter, custom-csv-reporter, custom-markdown-reporter',

    // mochawesome reporter for html and json.
    mochawesomeReporterOptions: {
      reportDir: 'cypress/reports',
      overwrite: true,
      html: true,
      json: true
    },

    // mochajunit reporter for xml reports.
    mochaJunitReporterOptions: {
      mochaFile: './cypress/reports/results.xml',
      outputs: true,
      includePending: true,
      toConsole: true
    },
  },
  e2e: {
    // Your Cypress e2e test settings here
  }
};
```

## Running Your Tests
After configuring the desired output formats, run your tests using:
```bash
npx cypress run
```

## Output Locations
**Markdown**: cypress/reports/test-results.md
**CSV**: cypress/reports/test-results.csv
**HTML**: cypress/reports/mochawesome.html
**XML**: cypress/reports/test-results-[hash].xml
**JSON**: cypress/reports/mochawesome.json

## References
- https://docs.cypress.io/app/tooling/reporters
- https://cytesting.github.io/cypress/2020/11/21/reporting-with-cypress-and-mochawesome.html